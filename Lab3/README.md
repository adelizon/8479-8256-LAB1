# 3η Εργαστηριακή Άσκηση 

## Μέρος 1ο

### Ερώτημα 1


Ο McPat αποτελεί έναν εξομοιωτή που μπορεί να μοντελοποιήσει αρχιτεκτονικές επεξεργαστών και να παράσχει εκτιμήσεις για τη κατανάλωση ισχύος τους.

Ας δούμε αρχικά, πως ορίζεται η κατανάλωση ισχύος σε έναν επεξεργαστή.

Οι πιο σημαντικοί παράγοντες που συμβάλλουν στη κατανάλωση ισχύος σε έναν επεξεργαστή έιναι η _**δυναμική κατανάλωση ισχύος**_, η _**κατανάλωση ισχύος βραχυκύκλωσης**_, καθώς και κατανάλωση που οφείλεται στα _**ρεύματα διαρροής**_ των τρανζίστορ. Μπορούμε να εκφράσουμε την κατανάλωση ενός επεξεργαστή ως:
_**Pcpu = Pdyn + Psc + Pleak**_

#### **Δυναμική κατανάλωση ισχύος (dynamic power loss):**
Η δυναμική κατανάλωση ισχύος προέρχεται από τη λειτουργία των λογικών πυλών μέσα στον επεξεργαστή. Πρακτικά, αναφέρεται στη κατανάλωση του επεξεργαστεί κατά την εκτέλεση μια λειτουργίας. Όπως γνωρίσουμε, οι λογικές πύλες μέσα σε έναν επεξεργαστή υλοποιούνται με τρανζίστορ, και εκφράζονται ως μια χωρητικότητα. Αυτό σημαίνει πως όταν η κατάσταση σε μια λογική πύλη αλλάζει (από 0 σε 1 ή από 1 σε 0), αυτό που συμβαίνει στην ουσία είναι ροή ενέργειας καθώς φορτίζεται ή εκφορτίζεται ένας πυκνωτής. Η δυναμική κατανάλωση ισχύος είναι κατά προσέγγιση ανάλογη με τη συχνότητα λειτουργίας του επεξεργαστή και με το τετράγωνο της τάσης τροφοδοσίας του και μπορεί να αποτυπωθεί με το τύπο:
**Pcpu = C(V^2)f**.

#### **Κατανάλωση ισχύος βραχυκύκλωσης:**
Όπως αναφέραμε παραπάνω, οι λογικές πύλες των επεξεργαστών αποτελούνται από τρανζίστορ. Αυτό σημαίνει πως η κατάσταση των τρανζίστορ αλλάζει κατά τη λειτουργία της πύλης. Καθώς ο χρόνος που απαιτείται για τη αλλαγή της κατάστασης ενός τρανζίστορ είναι πεπερασμένος, υπάρχει περίπτωση μερικές φορές να άγουν τρανζίστορ από τη τροφοδοσία προς τη γη ταυτόχρονα, δημιουργώντας για πολύ μικρό χρονικό διάστημα ένα βραχυκύκλωμα. Παρόλα αυτά η απώλειες αυτές είναι πολυ δύσκολο να μοντελοποιηθούν σε μακροσκοπική ανάλυση.

#### **Κατανάλωση λόγω ρευμάτων διαρροής (leakage - στατική κατανάλωση):**
Γίνεται εύκολα κατανοητό πως αυτή η κατανάλωση ωφείλεται στα ρεύματα διαρροής των τρανζίστορ. Υπάρχουν δύο κατηγορίες ρευμάτων. Η πρώτη είναι το ρεύμα διαρροής υποστρώματος, το οποίο είναι ρεύμα μεταξύ πηγής και εκπομπού του τρανζίστορ όταν η Vgs είναι μικρότερη από το threshold, καθώς και το ρεύμα διαρροής της πύλης το οποίο είναι αρκετά μικρότερο απ το πρώτο. (Αναφέρονται στα αποτελέσματα του McPAT ως **Subthreshold Leakage** και **Gate Leakage** αντίστοιχα). Τα ρεύματα αυτά σχετίζονται με τις διαστάσεις των τρανζίστορ, τις φυσικές τους ιδιότητες, τη τάση τροφοδοσίας και ενίοτε τη θερμοκρασία.

Υπάρχουν αρκετές τεχνικές για τη μείωση της κατανάλωσης ισχύος σε έναν επεξεργαστή και τα τελευταία χρόνια με την αύξηση των απαιτήσεων σε υπολογιστική ισχύ, η μειωμένη κατανάλωση είναι ακόμα πιο σημαντική και από την αύξηση των επιδόσεων. 
Μια από αυτές τις τεχνικές είναι και το **Power Gating** (αναφέρεται στην έξοδο του McPAT ως **subthreshold leakage with power gating**), κατά το οποίο διακόπτεται η τροφοδοσία σε μπλοκ τρανζίστορ τα οποία δε χρειάζονται εκείνη τη χρονική στιγμή, μειώνοντας έτσι το συνολικό ρεύμα διαρροής του επεξεργαστή. (Στην προσομοίωση του Xeon, παρατηρούμε πως η κατανάλωση λόγω διαρροής είναι λιγότερο από τη μισή με τη τεχνική του power gating.)


Εφόσον η δυναμική κατανάλωση ισχύος ωφείλεται στην λειτουργία του επεξεργασή ενώ η στατική κατανάλωση υπάρχει στην απουσία λειτουργίας, μπορούμε να καταλάβουμε πως διαφορετικά προγράμματα θα έχουν επίπτωση στη δυναμική κατανάλωση. Για παράδειγμα ένα απαιτητικό πρόγραμμα που απαιτεί πολλαπλές αριθμητικές πράξεις, προσπελάσεις της κύριας μνήμης κ.τ.λ., έχει ως αποτέλεσμα πολλές εναλλαγές στις καταστάσεις των λογικών πυλών και συνεπώς αύξηση κατανάλωσης. 
Όταν μιλάμε για τον ίδιο επεξεργαστή, μεγαλύτερη χρονική διάρκεια εκτέλεσης σημαίνει απαιτητικότερο πρόγραμμα γεγονός που θα οδηγήσει σε αυξημένη κατανάλωση. Ωστόσο αν μιλάμε για δύο διαφορετικούς επεξεργαστές, ο μεγαλύτερος χρόνος εκτέλεσης μπορεί να έγκειται σε χαμηλότερη συχνότητα λειτουργίας όπου οδηγεί σε χαμηλότερη κατανάλωση όπως αναφέρθηκε παραπάνω. Γι αυτό και η επιλογή συχνότητας λειτουργίας θα πρέπει να επιλέγεται ανάλογα με τις απαιτήσεις. (υπάρχουν ακόμα και τεχνικές όπως το Dynamic frequency scaling, κατά το οποίο η συχνότητα λειτουργίας προσαρμόζεται δυναμικά ανάλογα με τις ανάγκες.) Παράλληλα μεγαλύτερος χρόνος εκτέλεσης μπορεί αν σημαίνει μεγαλύτερα διαστήματα ηρεμίας σε blocks, που σημαίνει με τη σειρά του μεγαλύτερη στατική κατανάλωση.)


### Ερώτημα 2


Όπως είδαμε και στα δύο προηγούμενα εργαστήρια, η αύξηση της συχνότητας λειτουργίας ενός επεξεργαστή μειώνει τους χρόνους εκτέλεσης και αυξάνει τη ταχύτητα του. Παρόλα αυτά όπως αναφέραμε, η ραγδαία αύξηση των απαιτήσεων σε υπολογιστική ισχύ, έχει καταστήσει απαραίτητη την αύξηση της ενεργειακής αποδοτικότητας των επεξεργαστών. 
Όπως γνωρίζουμε, η ενεργειακή αποδοτικότητα είναι η εκμεταλλευόμενη ενέργεια προς την αρχική ενέργεια εισόδου. 
Για το πεδίο των επεξεργαστών, ορίζουμε την ενεργειακή αποδοτικότητα (energy efficiency) ως το βαθμό των υπολογισμών που μπορούν να πραγματοποιηθούν ανα 1 watt ισχύος που καταναλώνεται. Συνήθως εκφράζεται σε FLOPS/Watt. (Floating Point Operations Per Second)
Αντιλαμβανόμαστε λοιπόν, πως είναι πιθανό ένας επεξεργαστής που καταναλώνει 40 Watt εφόσον έχει καλύτερο energy efficiency (πρακτικά πραγματοποιεί τα tasks του σε πολύ λιγότερο χρόνο) από έναν επεξεργαστή που καταναλώνει 5Watt, να δίνει στο σύστημα μεγαλύτερη διάρκεια μπαταρίας καθώς θα λειτουργεί πιθανώς για πολύ λιγότερη ώρα. Από τον McPAT όμως δεν μπορούμε να πάρουμε μια τέτοια πληροφορία, καθώς θα πρέπει να συνδυαστεί με έναν προσομοιωτή σαν τον gem5 ώστε να χρησιμοποιήσει αποτελέσματα από τη λειτουργία του επεξεργαστή (CPI, SIMULATION TIME κτλ).


### Eρώτημα 3

Τρέχοντας τον McPAT για του επεξεργαστές XEON και ARM A9, παίρνουμε τα παρακάτω αποτελέσματα για τις καταναλώσεις τους
![] screenshot 
![] screenshot


Για τον XEON, έχουμε μια δυναμική κατανάλωση στα 72.9 Watt και μια στατική κατανάλωση στα 36.8 Watt.
Aντίστοιχα για τον ARM A9, η δυναμική κατανάλωση είναι στα 2.9 Watt και η στατική κατανάλωση στα 0.1 Watt.

Όπως γνωρίσουμε η ενέργεια και η ισχύς συνδέονται με το τύπο **E = Pt** όπου t ο χρόνος. Κάνοντας τις πράξεις οδηγούμαστε στο συμπέρασμα πως **Earm = 1.6Exeon**. Συμπεραίνουμε λοιπόν πως για την εκτέλεση του προγράμματος που αναφέρεται στην εκφώνηση της άσκησης (το οποίο ο XEON τρέχει 40 φορές γρηγορότερα, ο XEON δαπανά λιγότερη ενέργεια από τον ARM A9 αν και έχει μεγαλύτερη ισχύ.
Παρόλα αυτά, εφόσον το σύστημα δε σταματάει τη λειτουργία συστήματος μετά την εκτέλεση του προγράμματος, οι επεξεργαστές μας συνεχίζουν να δαπανούν ενέργεια λόγω της στατικής ισχύος τους. Εκεί τα πράγματα είναι τελείως διαφορετικά καθώς ο XEON έχει μια στατική ισχύ που είναι συγκρίσιμη ακόμα και με τη κατανάλωση του κατά την εκτέλεση του προγράμματος, ενώ η στατική ισχύς στον A9 βρίσκεται σε πολύ χαμηλά επίπεδα. Ολοκληρώνοντας ως προς το χρόνο που μένουν τα 2 συστήματα σε ηρεμία μετά το τέλος του προγράμματος, εύκολα παρατηρούμε πως ακόμα και για 1.5 δευτερόλεπτο ηρεμίας, ο XEON θα καταναλώσει περισσότερη ενέργεια (συνολικά μαζί με τη δυναμική ισχύ) απ' ότι ο A9, η διαφορά των οποίων μάλιστα θα αυξάνεται γεωμετρικά.

**Συμπεραίνουμε λοιπόν πως ο XEON δεν μπορεί να είναι πιο energy efficient από τον A9, ακόμα και με τέτοια διαφορά στην απόδοση**



## Μερος 2ο


### Ερώτημα 1

Στο δεύτερο μέρος της εργαστηριακής άσκησης, θα χρησιμοποιήσουμε τα [αποτελέσματα](https://github.com/adelizon/8479-8256-LAB1/tree/master/Lab2/results2ndpart_sjeng) που πήραμε για τις προσομοιώσεις του specsjeng για διάφορες dCache  και l2Cache στη δεύτερη εργασία.

Για το Energy - Delay - Area product, θα χρησιμοποιήσουμε το area από τα αποτελέσματα που μας δίνει ο McPAT. Για το delay, θα αντλήσουμε τις πληροφορίες από το simulation time των benchmarks, ενώ για τον υπολογισμό της ενέργειας όπως αναφέρθηκε παραπάνω, θα χρησιμοποιήσουμε τη σχέση **E = Pt**, για το runtime dynamic των core και l2cache αθροιστικά.

![](https://github.com/adelizon/8479-8256-LAB1/blob/master/Lab3/MCPAT%201.png)

![](https://github.com/adelizon/8479-8256-LAB1/blob/master/Lab3/core%20area.png)

![](https://github.com/adelizon/8479-8256-LAB1/blob/master/Lab3/core%20dynamic.png)

![](https://github.com/adelizon/8479-8256-LAB1/blob/master/Lab3/core%20gate.png)

![](https://github.com/adelizon/8479-8256-LAB1/blob/master/Lab3/core%20sub.png)

![](https://github.com/adelizon/8479-8256-LAB1/blob/master/Lab3/l2%20area.png)

![](https://github.com/adelizon/8479-8256-LAB1/blob/master/Lab3/l2%20runtime.png)

![](https://github.com/adelizon/8479-8256-LAB1/blob/master/Lab3/l2%20sub.png)

![](https://github.com/adelizon/8479-8256-LAB1/blob/master/Lab3/l2%20gate.png)


## Πηγές

[McPAT](https://pdfs.semanticscholar.org/dbb3/f7142c95631a347222950099aeb4661f8d5c.pdf?fbclid=IwAR3ra8oeZJ46_E6HUCDkk7vNYZrzGy9aVnv1tnkmFw82OfZj38gdqWjCW7o)

[CPU Power Dissipation](https://en.wikipedia.org/wiki/CPU_power_dissipation)

[Power Gating](https://en.wikipedia.org/wiki/Power_gating)

[Leakage](https://en.wikipedia.org/wiki/Leakage_(electronics))

[Static Power](https://www.sciencedirect.com/topics/computer-science/static-power)

[Dynamic frequency scaling](https://en.wikipedia.org/wiki/Dynamic_frequency_scaling)

[Dynamic Power](https://www.sciencedirect.com/topics/computer-science/dynamic-power-consumption)

![Energy - Delay product](http://www.eecs.harvard.edu/~dbrooks/cs246/cs246-lecture2.pdf)
